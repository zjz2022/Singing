## 3 UDP

### 3.1 UDP协议

UDP协议（User Datagram Protocol）或用户数据报协议，是一种无连接的传输层协议，为应用程序提供了一种无需建立连接就可以发送数据的服务。因此，使用UDP协议发送数据时可以不必等待对方确认，大大提高了发送效率。

UDP协议的主要特点：

- 无连接：即通信不需要建立和断开连接。

- 不可靠：它不对发送的数据包是否能到达接收方进行检查，也不需要对方对数据包进行应答，无需维护复杂的连接状态。

- 面向报文：UDP 是对用户网络层（IP协议）的数据包进行简单封装后直接发送，不需要像 TCP 那样对数据进行拆分和组装操作。

- 适用于实时应用：UDP 有很小的协议开销，适用于对实时性要求高的应用，例如 VoIP、视频会议和在线游戏等。

UDP协议的主要用途是在需要数据传输方仅需要发送一次数据，而且不关心是否达到目的地的情形中，如多播（multicast）和广播（broadcast）通信。

### 3.2 udp的应用场景(udp既然这么不可靠，那么它的应用场景有哪些)

确实，UDP协议不提供数据包到达确认，也就是所谓的“不可靠”，但是并不意味着它就没有用处。实际上，正因为UDP协议的特性，它在许多应用场景中表现出了优越性，主要应用如下：

1. 实时应用：包括VoIP（网络电话），视频会议等。这类应用对实时性和流畅性的要求高于数据的完整性。使用TCP可能会因为丢包重发导致延迟，影响用户体验，因而选择UDP协议。

2. 简单的请求/响应通信：由于UDP没有通信连接的建立和释放过程，用于简单的应答服为理通信非常高效。例如DNS查询，SNMP(简单网络管理协议)。

3. 广播和多播应用：在广播和多播类型的应用中,由于数据需要发送给多个接收者，如果使用可靠的连接导致复杂性指数增加，而UDP可以很好的支持这类应用。

4. 在线游戏： 游戏数据的实时性要求很高，对于一些数据包，甚至接收晚了都没有意义了。因此，很多在线游戏会用UDP作为通信协议。

尽管UDP协议本身不可靠，但在适合的应用中，通常会在应用层增加一些可靠性处理，比如重试、超时响应等，这样既保持了UDP的简洁高效，又增加了一定程度的可靠性。

### 3.3 tcp和udp的区别，分别的应用场景有哪些

TCP/IP 中有两个具有代表性的传输层协议，分别是 TCP 和 UDP。
来看看传输层位于OSI七层协议和TCP/IP四层协议的位置：
![OSI七层协议和TCP/IP四层协议](D:/%E6%96%87%E4%BB%B6/typora%E5%9B%BE%E7%89%87/4007070167-5e51e657970d8_articlex.png)

那么TCP和UDP的区别和使用场景分别是怎样的？
我们用一个图来对比一下UDP和TCP：
![img](D:/%E6%96%87%E4%BB%B6/typora%E5%9B%BE%E7%89%87/1806285859-5e51e6597ff7a_articlex.png)

#### TCP

TCP 是**面向连接**的、**可靠**的流协议。流就是指不间断的数据结构，当应用程序采用 TCP 发送消息时，虽然可以保证发送的顺序，但还是犹如没有任何间隔的数据流发送给接收端。
TCP是面向**面向字节流**，虽然应用程序和TCP的交互是一次一个数据块（大小不等），但TCP把应用程序看成是一连串的无结构的字节流。TCP有一个缓冲，当应用程序传送的数据块太长，TCP就可以把它划分短一些再传送。

TCP 为提供可靠性传输，实行“**顺序控制**”或“**重发控制**”机制。此外还具备“**流控制（流量控制）**”、“**拥塞控制**”、提高网络利用率等众多功能。

TCP有以下特点：

- TCP充分地实现了数据传输时各种控制功能，可以进行丢包时的重发控制，还可以对次序乱掉的分包进行顺序控制。而这些在 UDP 中都没有。
- 此外，TCP 作为一种面向有连接的协议，只有在确认通信对端存在时才会发送数据，从而可以控制通信流量的浪费。
- 根据 TCP 的这些机制，在 IP 这种无连接的网络上也能够实现高可靠性的通信（ **主要通过检验和、序列号、确认应答、重发控制、连接管理以及窗口控制**等机制实现）。

#### UDP

UDP 是**面向报文**的，所谓面向报文，是指面向报文的传输方式是应用层交给UDP多长的报文，UDP就照样发送，即一次发送一个报文。因此，应用程序必须选择合适大小的报文。若报文太长，则IP层需要分片，降低效率。若太短，会是IP太小。

UDP 是**不具有可靠性**的数据报协议，细微的处理它会交给上层的应用去完成。在 UDP 的情况下，虽然可以确保发送消息的大小，却不能保证消息一定会到达。因此，应用有时会根据自己的需要进行重发处理。

UDP有以下特点：

- UDP 不提供复杂的控制机制，利用 IP 提供面向无连接的通信服务。
- 传输途中出现丢包，UDP 也不负责重发。
- 当包的到达顺序出现乱序时，UDP没有纠正的功能。
- 并且它是将应用程序发来的数据在收到的那一刻，立即按照原样发送到网络上的一种机制。即使是出现网络拥堵的情况，UDP 也无法进行流量控制等避免网络拥塞行为。
- 如果需要以上的细节控制，不得不交由采用 UDP 的应用程序去处理。
- UDP 常用于以下几个方面：
  - 1.包总量较少的通信（DNS、SNMP等）；
  - 2.视频、音频等多媒体通信（即时通信）；
  - 3.限定于 LAN 等特定网络中的应用通信；
  - 4.广播通信（广播、多播）。

#### UDP 和 TCP 的应用

他们的应用如下图：
![img](D:/%E6%96%87%E4%BB%B6/typora%E5%9B%BE%E7%89%87/2639681048-5e51e65aac2b2_articlex.png)

#### 总结：

TCP 和 UDP 的优缺点无法简单地、绝对地去做比较：TCP 用于在传输层有必要实现可靠传输的情况；
而在一方面，UDP 主要用于那些对高速传输和实时性有较高要求的通信或广播通信。TCP 和 UDP 应该根据应用的目的按需使用。
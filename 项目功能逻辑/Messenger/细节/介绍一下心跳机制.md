## 介绍一下心跳机制

心跳机制常被用于实时通信中，用于持续检测和确保客户端和服务器之间的连接仍然有效。简单的形式是，客户端周期性地向服务器发送特定请求，，表示它“仍然活着”，服务器收到这个请求后返回确认消息。如果在设定的时间内没有收到心跳，就认定连接已经断开。

## websocket

WebSocket 是一种网络通信协议，它在单个 TCP 连接上提供全双工通信通道，能够实现客户端与服务器之间的实时双向交互。通过 WebSocket，服务器可以主动向客户端推送信息，而在 HTTP 协议中，只能由客户端主动发起请求。

## 消息已读

通常消息“已读”标记会在用户打开或者查看消息后由客户端发送给服务器，然后服务器更新消息状态。这个需求的实现具体取决于你的应用是如何处理和存储消息的。

## pusher 原理

Pusher 应用 WebSocket TCP 长连接供实时双向通信。Pusher 得以将实时事件分发到客户端，这些客户端订阅了这些事件。后端服务触发事件，它们会带着关联数据被分发到所有的订阅客户端。

## 说说 websocket

前后端交互通常有 HTTP 和 WebSocket 2 种通讯方式

WebSocket 是 HTML5 标准的一部分，它提供了**全双工**的通信通道。一次握手后，客户端和服务器之间的所有通信都是持久的、双向的，比传统的 HTTP 请求更有效率。

## 断开连接怎么办

对于互联网应用，连接断开是必然会碰到的问题。常见的处理方式是重连机制。例如，如果发现 WebSocket 断开，可以尝试自动重新创建一个新的 WebSocket；或者，在使用 Pusher 这样的服务时，可以利用其提供的自动重连功能。

## 用户的在线离线状态是怎么去处理的呀（滴滴）

一种常见的方法是采用心跳机制，即客户端定期向服务器发送信号，表明它仍然在线，如果服务器在一段时间内没有接收到来自客户端的信号，那么就认为客户端已经离线。在使用 Stomp 或 Socket.io 这样的库时，这个功能通常已经内置完成。

## 消息已读怎么做

对于已读回执，我们可以在用户查看了消息后，向后端发送一个确认的请求，然后在数据库中标记该消息为已读。同时，我们也可以通过 Pusher，将这个信息推送给消息发送者。

一种常见的实现方式是，当用户打开聊天应用并读取了新消息后，发送一个请求到服务器，说明用户已经读取了这些消息。服务器接收到这个请求后，可以更新这些消息的状态，然后通过 WebSocket 或其他实时通信工具告诉其他用户这些消息已被读取。

## pusher 是怎么进行通信的，原理是什么

Pusher 在后端服务和客户端之间建立一个 Websocket 连接，实现全双工的实时数据传输。当后端产生新的消息时，可以通过 Pusher 发出一个事件，所有监听这个事件的客户端都能够接收到这个事件和相关的数据。

Pusher 应用 WebSocket TCP 长连接供实时双向通信。Pusher 得以将实时事件分发到客户端，这些客户端订阅了这些事件。后端服务触发事件，它们会带着关联数据被分发到所有的订阅客户端。

## 用户在线，离线状态，是怎么处理的？后端的逻辑是怎么判断用户是离线还是在线的？

### 在线离线

在此应用中，我们使用了 Pusher 的 Presence Channels 来跟踪用户的在线状态。当用户订阅特定的 Presence Channel 时，我们视为用户在线；当他们取消订阅或断开连接时，我们视为用户离线。

原理：在实时聊天程序中，通常我们可以使用 websocket 来持续追踪用户的在线状态。当用户加载应用的时候，会建立一个到服务器的 websocket 连接，此时用户在线；当 websocket 连接断开时，用户离线。

Pusher 这样的实时通讯服务解决方案来处理用户在线离线状态。

### 后端逻辑

在后端，我们可以通过检测用户的活动状态或者监听特定的网络事件来判断用户是否在线。

1. 检测用户的活动状态：在这种方法中，通常采用 session 或 token 的方式。当用户成功登录后，后端会创建一个 session 或者生成一个 token，然后这个 session 或 token 会被发送给前端并存储在用户的本地中，如 cookie。在后续的每个请求中，这个 session 或 token 都会被提交到后端，后端通过检查 session 或 token 有效性来确定用户是否在线。
2. 监听网络事件：当用户的浏览器关闭了与服务端的连接，服务端会接收到一个网络事件，例如 WebSocket 连接断开事件，通过这个可以知道用户已经离线。

对于使用了 Pusher 服务的项目，Pusher 提供了 Presence Channels 功能，使得我们可以在用户连接和断开连接时接收到事件通知，进而得知用户的在线状态。

具体实践中，服务端的逻辑可能会去结合使用上述方法来获取比较准确的用户在线状态。

## 介绍下实时通信项目，pusher，重连机制，用 pusher 的好处是什么，详细讲讲 websocket（太细啦，感觉被扒光光）

Pusher 是一种实时通信服务，它提供了 WebSocket 接口来让你的应用实时地接收服务端消息。Pusher 的好处是你无需自建实时通信服务器，直接使用它的 API 即可实现需要的功能。如果连接中断，Pusher 库会自动尝试重新连接。WebSocket 是一种网络通信协议，它在单个 TCP 连接上提供全双工通信通道，在客户端和服务器之间，可以实现实时双向数据传输。
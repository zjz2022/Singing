## JWT

​		JWT（JSON web token）是一个JSON信息传输的开放标准，它可以使用密钥对信息进行数字签名(生成token)，以确保信息是可验证和可信任的。JWT由三部分构成：header（头部）、payload（载荷）和signature（签名）。

```
header承载两部分信息：
{'typ': 'JWT',	  //声明类型 这里是jwt
  'alg': 'HS256'} //声明加密的算法 通常直接使用 HMAC SHA256
payload存放有效信息的地方。这个名字像是特指飞机上承载的货品，这些有效信息包含三个部分：标准中注册的声明、公共的声明、私有的声明
signature是一个签证信息，这个签证信息由三部分组成：header (base64后的)、payload (base64后的)和secret
	
```

**注意**：**secret是保存在服务器端的，jwt的签发生成也是在服务器端的**，secret就是用来进行jwt的签发和jwt的验证，所以，它就是你服务端的私钥，在任何场景都不应该流露出去。一旦客户端得知这个secret, 那就意味着客户端是可以自我签发jwt了。

**基于Session的认证：**

1. 首先用户向服务器发送用户名和密码。
2. 然后服务器将数据保存再，session里面。
3. 服务器向用户返回一个session_id，写入给用户的Cookie。
4. 用户之后的每一次请求，都会将通过Cookie将session_id返回到服务器。
5. 服务器收到了session_id，找到前期保存的数据，从而得到用户的身份。

基于session认证所显露的问题：

1. Session: 每个用户经过我们的应用认证之后，我们的应用都要在服务端做一次记录，以方便用户下次请求的鉴别，通常而言session都是保存在内存中，而随着认证用户的增多，服务端的开销会明显增大。
2. 扩展性: 用户认证之后，服务端做认证记录，如果认证的记录被保存在内存中的话，这意味着用户下次请求还必须要请求在这台服务器上,这样才能拿到授权的资源，这样在分布式的应用上，相应的限制了负载均衡器的能力。这也意味着限制了应用的扩展能力。
3. CSRF: 因为是基于cookie来进行用户识别的, cookie如果被截获，用户就会很容易受到跨站请求伪造的攻击。

**基于token的鉴权机制**

基于token的鉴权机制类似于http协议也是无状态的，它不需要在服务端去保留用户的认证信息或者会话信息。这就意味着基于token认证机制的应用不需要去考虑用户在哪一台服务器登录了，这就为应用的扩展提供了便利。

流程上是这样的：

1. 用户使用用户名密码来请求服务器
2. 服务器进行验证用户的信息
3. 服务器通过验证发送给用户一个token
4. 客户端存储token，并在每次请求时附送上这个token值
5. 服务端验证token值，并返回数据

这个token必须要在每次请求时传递给服务端，它应该保存在请求头里， 另外，服务端要支持**CORS(跨来源资源共享)策略**，一般我们在服务端这么做`Access-Control-Allow-Origin: *`。

**JWT优点**

1. 因为json的通用性，所以JWT是可以进行跨语言支持的，像JAVA,JavaScript,NodeJS,PHP等很多语言都可以使用；
2. 因为有了payload部分，所以JWT可以在自身存储一些其他业务逻辑所必要的非敏感信息；
3. 便于传输，jwt的构成非常简单，字节占用很小，所以它是非常便于传输的；
4. 它不需要在服务端保存会话信息, 所以它易于应用的扩展。

**JWT缺点**

1. 不应该在jwt的payload部分存放敏感信息，因为该部分是客户端可解密的部分；
2. 保护好secret私钥，该私钥非常重要；
3. 如果可以，请使用https协议。
4. 一旦生成就无法更改。
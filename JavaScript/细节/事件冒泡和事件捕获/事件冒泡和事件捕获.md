## 事件冒泡和捕获

### 44.1 概念

事件冒泡和事件捕获是浏览器处理事件的两种机制。

#### 事件冒泡

事件冒泡是事件处理的默认方式。当一个元素上的事件被触发时，比如点击事件，这个事件会从最深的节点（也就是点击的那个节点）开始，然后逐级向上报告，也就是向上传播，经过每一层的父节点，直到document对象。这就是事件冒泡。

例如，如果你点击了一个完全由其他元素包裹的元素，点击事件将从你实际点击的元素开始，然后向上通过其各级父元素，一直传播到body元素。

#### 事件捕获

与事件冒泡相反，事件捕获是从最外层元素开始处理，然后逐级向下直到目标元素。这就是事件捕获。

如果我们在同一个节点上设置了两个相反的事件传播 （一个捕获，一个冒泡），那么哪一个先执行呢？答案是捕获型事件先执行。这是由DOM事件流模型决定的。

在实际开发中，我们可以选择使用冒泡还是捕获。默认情况下，所有事件处理器都注册为冒泡阶段的事件处理函数。如果我们希望在捕获阶段处理事件，我们可以在添加事件处理器时，将第三个参数设置为true。

例如 element.addEventListener('click', clickHandler, true) 就是在捕获阶段添加click事件处理函数。

了解事件冒泡和事件捕获对于编写事件处理代码非常有帮助，我们可以根据需要选择正确的事件处理机制。

### 44.2 实际应用场景

在写代码的过程中，我们会经常遇到要用到事件冒泡和事件捕获的情况。以下是一些常见的实际应用场景：

1. 事件委托（事件代理）：这是最常见的一个场景。例如，在一个列表中，我们希望每一个列表项都有点击事件。但是，在每一个列表项上都单独添加事件监听器，这样既消耗性能，又难以维护。这时候，我们就可以利用事件冒泡到列表的父元素上，只在这个父元素上添加一个事件监听器，然后通过事件对象的 target 属性来判断是哪个列表项被点击。

2. 阻止默认行为：在一些情况下，我们可能需要阻止某个元素的某个默认事件行为，我们就可以使用事件冒泡或事件捕获来实现。例如，阻止一个链接的默认点击行为（跳转），我们可以给这个链接元素添加一个点击事件的监听器，然后在这个监听器中调用 event.preventDefault()。

3. 自定义事件：在一些复杂的应用中，我们可能需要自定义一些事件。这时，我们可以通过创建自定义的事件对象，并利用事件冒泡或事件捕获来触发和监听这些事件。

4. 组件通讯：对于一些组件化的框架（例如React、Vue等），可以通过事件冒泡来实现父子组件或者兄弟组件之间的通讯。

5. 解决特殊问题：有的时候，我们可能会遇到一些特殊的问题，可以通过合理使用事件冒泡和事件捕获来解决。例如，解决点击穿透问题，我们就可以利用事件捕获机制，先捕获取到事件，然后进行处理。

总的来说，在写代码的过程，掌握事件冒泡和事件捕获机制，可以使我们在遇到一些复杂情况时，更好地解决问题。

### 44.3 如何阻止事件冒泡，方案有哪些，具体代码该怎么写

阻止事件冒泡的常见方案有以下几种：

1. 使用event.stopPropagation()方法。这是最常用和最标准的方法。这个方法阻止了事件继续在DOM树上冒泡。

2. 在旧版本的IE中（IE版本低于9），需要使用事件对象的cancelBubble属性来阻止事件冒泡。

以下是具体的代码示例：

### 使用event.stopPropagation()方法

```js
element.addEventListener('click', function(event) {
    event.stopPropagation();
});
```


### 在旧版本的IE中使用cancelBubble属性：

```js
element.attachEvent('onclick', function(event) {
    event = event || window.event; // 在IE中，需要通过window.event获取事件对象
    event.cancelBubble = true;
});
```


在实际的项目中，通常我们会检查stopPropagation方法和cancelBubble属性的存在性，以实现在不同浏览器中都有效的阻止事件冒泡的效果：

```js
element.addEventListener('click', function(event) {
    event = event || window.event; // 获取事件对象
    if(event.stopPropagation) { // 如果存在stopPropagation方法
        event.stopPropagation();
    } else { // 在旧版本IE中，使用cancelBubble属性
        event.cancelBubble = true;
    }
});
```

以上就是阻止事件冒泡的常见方法和具体代码。在使用时请根据实际的浏览器环境和项目需求选择合适的方法。
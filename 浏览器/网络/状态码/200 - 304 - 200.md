#### HTTP 304状态码的详细讲解

304 状态码或许不应该认为是一种错误，而是对客户端有缓存情况下服务端的一种响应。

###### 整个请求响应过程如下：

- 客户端在请求一个文件的时候，发现自己缓存的文件有 Last Modified ，那么在请求中会包含 If Modified Since ，这个时间就是缓存文件的 Last Modified 。因此，如果请求中包含 If Modified Since，就说明已经有缓存在客户端。服务端只要判断这个时间和当前请求的文件的修改时间就可以确定是返回 304 还是 200 （附加条件还有：If-Modified-Since、If-Match、If-None-Match、If-Range）
- 对于静态文件，例如：CSS、图片，服务器会自动完成 Last Modified 和 If Modified Since 的比较，完成缓存或者更新。但是对于动态页面，就是动态产生的页面，往往没有包含 Last Modified 信息，这样浏览器、网关等都不会做缓存，也就是在每次请求的时候都完成一个 200 的请求。
- 因此，对于动态页面做缓存加速，首先要在 Response 的 HTTP Header 中增加 Last Modified 定义，其次根据 Request 中的 If Modified Since 和被请求内容的更新时间来返回 200 或者 304 。虽然在返回 304 的时候已经做了一次数据库查询，但是可以避免接下来更多的数据库查询，并且没有返回页面内容而只是一个 HTTP Header，从而大大的降低带宽的消耗，对于用户的感觉也是提高。当这些缓存有效的时候，通过 Fiddler 或HttpWatch 查看一个请求会得到这样的结果：

> 第一次访问 200
> 按F5刷新（第二次访问） 304
> 按Ctrl+F5强制刷新 200

###### Last-Modified 与 If-Modified-Since

- 1.基本定义
  Last-Modified 与If-Modified-Since 都是标准的HTTP请求头标签，用于记录页面的最后修改时间。
- 2.发送方向
  Last-Modified 是由服务器发送给客户端的HTTP请求头标签
  If-Modified-Since 则是由客户端发送给服务器的HTTP请求头标签
- 3.应用场景
  （1）Last-Modified
  在浏览器第一次请求某一个URL时，服务器端的返回状态会是200，内容是你请求的资源，同时有一个Last-Modified的属性标记此文件在服务期端最后被修改的时间，格式类似这样：
  `Last-Modified: Fri, 12 May 2006 18:53:33 GMT`
  后面跟的时间是服务器存储的文件修改时间
  （2）If-Modified-Since
  客户端第二次请求此URL时，根据 HTTP 协议的规定，浏览器会向服务器传送 If-Modified-Since 报头，询问该时间之后文件是否有被修改过：
  `If-Modified-Since: Fri, 12 May 2006 18:53:33 GMT`
  后面跟的时间是本地浏览器存储的文件修改时间

> 如果服务器端的资源没有变化，则时间一致，自动返回HTTP状态码304（Not Changed.）状态码，内容为空，客户端接到之后，就直接把本地缓存文件显示到浏览器中，这样就节省了传输数据量。

> 如果服务器端资源发生改变或者重启服务器时，时间不一致，就返回HTTP状态码200和新的文件内容，客户端接到之后，会丢弃旧文件，把新文件缓存起来，并显示到浏览器中。

> 以上操作可以保证不向客户端重复发出资源，也保证当服务器有变化时，客户端能够得到最新的资源。

#### 2xx 成功

- 200 OK
  表示从客户端发来的请求在服务端正常处理了
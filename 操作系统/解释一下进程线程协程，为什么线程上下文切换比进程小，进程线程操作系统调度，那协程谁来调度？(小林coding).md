## 解释一下进程线程协程，为什么线程上下文切换比进程小，进程线程操作系统调度，那协程谁来调度？(小林coding)

**解析**

> 高频考题：属于高频考题：自产《[大厂后端Top100面试题讲解｜第59题](https://mp.weixin.qq.com/s?__biz=Mzk0OTM5MDMzNg==&mid=2247483813&idx=1&sn=d76cd77235886194667bb81cd1920b64&scene=21#wechat_redirect)》
>
> 所属专项：操作系统｜进程管理
>
> 专项考察占比：
>
> 【**操作系统**】面试中考察操作系统的比率：[大厂：12%](https://mp.weixin.qq.com/s?__biz=Mzk0OTM5MDMzNg==&mid=2247483843&idx=1&sn=7c7bd2c6b906c0ab38c868b84b88da56&chksm=c3585cacf42fd5ba38542da8ac77a7e731b486243c4aaf249d46d91b6c5e0e4e945f9729ad98&token=1036259463&lang=zh_CN&scene=21#wechat_redirect)｜ [腾讯：18%](https://mp.weixin.qq.com/s?__biz=Mzk0OTM5MDMzNg==&mid=2247483854&idx=1&sn=668db515e36dcdc8c180b11abef66e72&chksm=c3585ca1f42fd5b7d399b32a3c909b61a16f13c3bdb6ef6e0461470acdd3955c33a8a0d46120&token=1036259463&lang=zh_CN&scene=21#wechat_redirect)｜ [阿里：8%](https://mp.weixin.qq.com/s?__biz=Mzk0OTM5MDMzNg==&mid=2247483854&idx=1&sn=668db515e36dcdc8c180b11abef66e72&chksm=c3585ca1f42fd5b7d399b32a3c909b61a16f13c3bdb6ef6e0461470acdd3955c33a8a0d46120&token=1036259463&lang=zh_CN&scene=21#wechat_redirect)
>
> 【**操作系统-网络系统**】面试考察操作系统时，问“进程管理”相关问题的比率：[32%](https://mp.weixin.qq.com/s?__biz=Mzk0OTM5MDMzNg==&mid=2247483843&idx=1&sn=7c7bd2c6b906c0ab38c868b84b88da56&chksm=c3585cacf42fd5ba38542da8ac77a7e731b486243c4aaf249d46d91b6c5e0e4e945f9729ad98&token=1036259463&lang=zh_CN&scene=21#wechat_redirect)

1. 进程，线程，协程的区别

- 首先，我们来谈谈**进程**。进程是操作系统中进行资源分配和调度的基本单位，它拥有自己的独立内存空间和系统资源。每个进程都有独立的堆和栈，不与其他进程共享。进程间通信需要通过特定的机制，如管道、消息队列、信号量等。由于进程拥有独立的内存空间，因此其稳定性和安全性相对较高，但同时上下文切换的开销也较大，因为需要保存和恢复整个进程的状态。
- 接下来是**线程**。线程是进程内的一个执行单元，也是CPU调度和分派的基本单位。与进程不同，线程共享进程的内存空间，包括堆和全局变量。线程之间通信更加高效，因为它们可以直接读写共享内存。线程的上下文切换开销较小，因为只需要保存和恢复线程的上下文，而不是整个进程的状态。然而，由于多个线程共享内存空间，因此存在数据竞争和线程安全的问题，需要通过同步和互斥机制来解决。
- 最后是**协程**。协程是一种用户态的轻量级线程，其调度完全由用户程序控制，而不需要内核的参与。协程拥有自己的寄存器上下文和栈，但与其他协程共享堆内存。协程的切换开销非常小，因为只需要保存和恢复协程的上下文，而无需进行内核级的上下文切换。这使得协程在处理大量并发任务时具有非常高的效率。然而，协程需要程序员显式地进行调度和管理，相对于线程和进程来说，其编程模型更为复杂。

### 进程上下文切换和线程上下文切换？

首先是**进程**上下文切换。在**切换内容**方面，进程上下文切换涉及的内容较为广泛。由于进程是操作系统中进行资源分配和调度的基本单位，它拥有自己的独立内存空间和系统资源，因此进程上下文切换不仅包含了虚拟内存、栈、全局变量等用户空间的资源，还包括了内核堆栈、寄存器等内核空间的资源。这些资源在切换时都需要被保存和恢复，以确保新进程能够在切换后顺利执行。

在**发生场景**上，进程上下文切换主要发生在以下几种情况：一是进程主动调用某些系统调用时，如等待IO完成或者获取锁，这时进程无法继续运行，操作系统会触发上下文切换；二是进程分配到的时间片用完，或者有更高优先级的进程需要抢占CPU时，也会发生上下文切换。

接下来是**线程**上下文切换。在**切换内容**方面，线程上下文切换主要涉及线程在执行过程中的运行条件和状态，如程序计数器、栈信息、寄存器的值等。由于线程共享进程的内存空间，因此线程上下文切换不需要像进程上下文切换那样涉及大量的内存和资源管理。

线程上下文切换**发生场景**主要包括：线程主动让出CPU，例如调用了Thread.sleep()或Object.wait()等方法；当一个线程的时间片用完，需要切换到另一个线程继续执行；或者线程因为阻塞或等待某个事件而无法继续执行时，调度器会切换到另一个线程继续执行。

**推荐学习资料：**

- 《博客》| 腾讯云开发者社区: #一文读懂什么是进程、线程、协程
- 《小林Coding》｜图解系统：# 进程、线程基础知识
- 《小林Coding》｜图解系统：# 进程的上下文切换
- 《小林Coding》｜图解系统：# 线程的上下文切换

## 网站指标

1. **停留时间**

​		页面停留时间（Time on Page）简称 Tp，是网站分析中很常见的一个指标，用于反映用户在某些页面上停留时间的长短，传统的Tp统计方法会存在一定的统计盲区，比如无法监控单页应用，没有考虑用户切换Tab、最小化窗口等操作场景。基于上述背景，重新调研和实现了精确统计页面停留时长的方案，需要 兼容单页应用和多页应用，并且不耦合或入侵业务代码。

​		我们可以把一个页面生命周期抽象为三个动作：「进入」、「活跃状态切换」、「离开」

| 进入 | 首次加载，页面刷新，页面跳转，浏览器前进后退              |
| ---- | --------------------------------------------------------- |
| 切换 | 页面失去焦点/获得焦点，切换窗口最小化，切换 tab，电脑睡眠 |
| 离开 | 关闭页面，跳转页面，刷新，浏览器前进后退                  |

​		对于常规页面的 首次加载、页面关闭、刷新 等操作都可以通过 window.onload 和 window.onbeforeunload 事件来监听页面进入和离开，浏览器前进后退可以通过 pageshow 和 pagehide 处理。

- load / beforeunload
- pageshow / pagehide

对于单页应用内部的跳转可以转化为两个问题：

- 监听路由变化
- 判断变化的URL是否为不同页面 。

监听路由变化

​		目前主流的单页应用大部分都是基于 browserHistory (history api) 或者 hashHistory 来做路由处理，我们可以通过监听路由变化来判断页面是否有可能切换。注意是有可能切换，因为URL发生变化不代表页面一定切换，具体的路由配置是由业务决定的（既URL和页面的匹配规则）。browserHistory变化本质都会调用 History.pushState() 或 History.replaceState() ，能监听到这两个事件就能知道。通过 popstate 事件能解决一半问题，因为 popstate 只会在浏览器前进后退的时候触发，当调用 history.pushState() or history.replaceState() 的时候并不会触发。hashHistory 的实现是基于 hash 的变化，hash 的变化可以通过 hashchange 来监听

判断URL是否为不同页面

- 通过业务方在初始化的时候配置页面规则，然后JS通过URL匹配不同的规则来区分不同的页面。
- 每次URL发生变化就将数据上报，最终通过数据平台配置的页面URL规则来求和、过滤数据等

[#前端#]()[#前端面试#]()[#春招#](
## 基于RBAC权限管理控制

https://blog.csdn.net/hudongdong2020/article/details/116837023

### 什么是RBAC

RBAC目前使用最为广泛的权限模型
RBAC（基于角色的权限控制）模型的核心是在**用户和权限**之间引入了**角色**的概念,取消了用户和权限的直接关联，改为通过用户关联角色、角色关联权限的方法来间接地赋予[用户权限](https://so.csdn.net/so/search?q=用户权限&spm=1001.2101.3001.7020)，从而达到用户和权限解耦的目的。

![image-20240317125633041](D:/%E6%96%87%E4%BB%B6/typora%E5%9B%BE%E7%89%87/image-20240317125633041.png)

RBAC权限的过程可以抽象概括为：判断【Who是否可以对What进行How的访问操作（Operator）】这个逻辑表达式的值是否为True的求解过程。

即将权限问题转换为Who、What、How的问题，需要定义的是角色、资源和行为。

需要考虑：

系统有哪些用户，可以分为哪些角色；

系统有哪些功能（资源）需要按权限来划分；

功能（资源）的拆分粒度，到页面还是到具体按钮操作；

新用户的默认角色和权限；

用户与角色是“多对一”还是“多对多”；

新增的功能是默认全部角色“可用”还是“不可用”；

### RBAC的优点是啥

![image-20240317125916463](D:/%E6%96%87%E4%BB%B6/typora%E5%9B%BE%E7%89%87/image-20240317125916463.png)

![image-20240317125924184](D:/%E6%96%87%E4%BB%B6/typora%E5%9B%BE%E7%89%87/image-20240317125924184.png)

### 说说权限管理你是怎么做的吧?



有很多人表示他们公司的路由表是于后端根据用户的权限动态生成的，我司不采取这种方式的原因如下：



- 项目不断的迭代你会异常痛苦，前端新开发一个页面还要让后端配一下路由和权限，让我们想了曾经**前后端不分离**，被后端支配的那段恐怖时间了。

- 其次，就拿我司的业务来说，虽然后端的确也是有权限验证的，但它的验证其实是针对业务来划分的，比如超级编辑可以发布文章，而实习编辑只能编辑文章不能发布，但对于前端来说不管是超级编辑还是实习编辑都是有权限进入文章编辑页面的。所以前端和后端权限的划分是不太一致。

- 还有一点是就vue2.2.0之前异步挂载路由是很麻烦的一件事！不过好在官方也出了新的api，虽然本意是来解决ssr的痛点的。。。



### 具体怎么实现的权限管理呢?

![image-20240317125945198](D:/%E6%96%87%E4%BB%B6/typora%E5%9B%BE%E7%89%87/image-20240317125945198.png)

![image-20240317130000910](D:/%E6%96%87%E4%BB%B6/typora%E5%9B%BE%E7%89%87/image-20240317130000910.png)

![image-20240317130017993](D:/%E6%96%87%E4%BB%B6/typora%E5%9B%BE%E7%89%87/image-20240317130017993.png)

### 路由拦截怎么做的？

这里还需要用到vue-router的一个钩子，beforeEach这个全局守卫，他有三个参数:to,from,next

- **to**:你要跳转去的页面的route信息

- **from**：当前页面的route信息

- **next**:需要使用这个方法来resolve钩子，不然无法成功进行页面跳转

![image-20240317130111028](D:/%E6%96%87%E4%BB%B6/typora%E5%9B%BE%E7%89%87/image-20240317130111028.png)

### 菜单权限要怎么控制呢?



常见的菜单权限控制有两种办法，**前端控制**和**后端控制**，不过最好是前端来进行控制，不然你想加一个菜单还必须要和后端说，让他加一个菜单，会比较麻烦。
不过不管是前端控制还是后端控制，都需要拿到登录用户对应的菜单列表，然后通过vue-router的addRoutes方法将路由添加上去。



**怎么解决的?**
具体实现方法是，前端控制可以给路由表每一个路由都添加一个**唯一Id**,我之前的写法是直接给死role:['admin','test']这样写的，但是这样写有一个问题，如果某个角色想修改权限或者是新加了一个角色，这样子还得重新修改代码，所以这次修改直接给每一个菜单一个对应的roleId,之后就根据**登录时的roleIds**和**路由表里面roleId**进行比对，获取到当前用户对应的菜单。

![image-20240317130145399](D:/%E6%96%87%E4%BB%B6/typora%E5%9B%BE%E7%89%87/image-20240317130145399.png)

### 权限的路由表要怎么设计呢?



路由表里面可以定好两种路由，一种是不需要权限控制的，如：登录页，404页面等，一种是需要权限控制的； 这里basRoute就是基础路由，asyncRoutes是需要权限控制的路由，这里是store的permission文件，主要功能就是根据登录用户的roleIds获取对应的路由菜单

![image-20240317130205890](D:/%E6%96%87%E4%BB%B6/typora%E5%9B%BE%E7%89%87/image-20240317130205890.png)

![image-20240317130218174](D:/%E6%96%87%E4%BB%B6/typora%E5%9B%BE%E7%89%87/image-20240317130218174.png)
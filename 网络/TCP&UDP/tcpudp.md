### tcp|udp

HTTP、TCP 和 UDP 是网络通信中的三个重要协议，它们各自在网络通信的不同层次和环节起到了关键的作用。

HTTP（HyperText Transfer Protocol）是应用层协议，主要用于在Web上传输信息，如HTML文档。它可以运行在TCP之上，也可以运行在其他的网络协议上。HTTP定义了客户端（通常是Web浏览器）如何向服务器发送请求，以及服务器如何返回响应。

TCP（Transmission Control Protocol）是传输层协议，负责在网络中的两个主机之间提供可靠的、有序的和基于字节流的数据传输。TCP使用确认和重传机制来保证数据的可靠传输，并使用拥塞控制机制来避免网络拥塞。HTTP就是运行在TCP之上的一个应用层协议。

UDP（User Datagram Protocol）也是传输层协议，但它与TCP不同，它提供的是一种无连接的服务，数据的传输既不保证可靠，也不保证有序。由于UDP没有TCP那样的确认和重传机制，因此它的开销比TCP小，实时性更好，适合于对实时性要求高的应用，如VoIP（网络电话）和实时视频会议等。

以下是它们的主要区别：

- 可靠性：TCP提供了可靠的数据传输，保证了数据的有序和无误。而UDP不保证数据的可靠传输，数据可能会丢失或者乱序。HTTP运行在TCP之上，因此也是可靠的。
- 连接性：TCP是连接导向的，通信双方在传输数据之前需要先建立连接。而UDP是无连接的，每个数据报都是独立传输的。HTTP作为应用层协议，其连接性取决于底层的传输协议，通常情况下，HTTP会在TCP的基础上建立连接。
- 实时性：由于UDP没有TCP那样复杂的确认和重传机制，因此UDP的实时性更好，适合于对实时性要求高的应用。而HTTP和TCP则更适合于对可靠性要求高的应用。
- 头部开销：TCP的头部开销比UDP大，因为TCP需要包含更多的信息，如序列号、确认号等，以支持它的可靠性和连接性。HTTP的头部开销则取决于HTTP的版本，HTTP/1.1的头部开销比较大，而HTTP/2和HTTP/3采用了头部压缩技术，大大减小了头部开销。
- 使用场景：HTTP主要用于Web应用，如网页浏览、表单提交等。TCP则可以用于各种需要可靠传输的网络应用，如文件传输、电子邮件、远程登录等。UDP则适合于需要快速传输和对实时性要求高的应用，如网络电话、实时视频会议和在线游戏等。

**TCP和 UDP 区别**

TCP 是**面向连接**的、**可靠**的流协议。流就是指不间断的数据结构，当应用程序采用 TCP 发送消息时，虽然可以保证发送的顺序，但还是犹如没有任何间隔的数据流发送给接收端。TCP是面向**面向字节流**，虽然应用程序和TCP的交互是一次一个数据块（大小不等），但TCP把应用程序看成是一连串的无结构的字节流。TCP有一个缓冲，当应用程序传送的数据块太长，TCP就可以把它划分短一些再传送。

TCP 为提供可靠性传输，实行“**顺序控制**”或“**重发控制**”机制。此外还具备“**流控制（流量控制）**”、“**拥塞控制**”、提高网络利用率等众多功能。

TCP有以下特点：

- TCP充分地实现了数据传输时各种控制功能，可以进行丢包时的重发控制，还可以对次序乱掉的分包进行顺序控制。而这些在 UDP 中都没有。
- 此外，TCP 作为一种面向有连接的协议，只有在确认通信对端存在时才会发送数据，从而可以控制通信流量的浪费。
- 根据 TCP 的这些机制，在 IP 这种无连接的网络上也能够实现高可靠性的通信（ **主要通过检验和、序列号、确认应答、重发控制、连接管理以及窗口控制**等机制实现）。

基于 TCP 的应用层协议：FTP（文件传输）、HTTP（万维网）、SMTP（电子邮件）

当**网络拥塞**时，减少数据的发送。发送方有拥塞窗口，发送数据前比对接收方发过来的接收窗口，取两者的最小值---慢启动、拥塞避免、拥塞发送、快速恢复

**UDP**

​		UDP是一个非连接的协议，传输数据之前源端和终端不建立连接， 当它想传送时就简单地去抓取来自应用程序的数据，并尽可能快地把它扔到网络上。 在发送端，UDP传送数据的速度仅仅是受应用程序生成数据的速度、 计算机的能力和传输带宽的限制； 在接收端，UDP把每个消息段放在队列中，应用程序每次从队列中读一个消息段。

UDP 是**面向报文**的，所谓面向报文，是指面向报文的传输方式是应用层交给UDP多长的报文，UDP就照样发送，即一次发送一个报文。因此，应用程序必须选择合适大小的报文。若报文太长，则IP层需要分片，降低效率。若太短，会是IP太小。

UDP 是**不具有可靠性**的数据报协议，细微的处理它会交给上层的应用去完成。在 UDP 的情况下，虽然可以确保发送消息的大小，却不能保证消息一定会到达。因此，应用有时会根据自己的需要进行重发处理。

UDP有以下特点：

- UDP 不提供复杂的控制机制，利用 IP 提供面向无连接的通信服务。
- 传输途中出现丢包，UDP 也不负责重发。
- 当包的到达顺序出现乱序时，UDP没有纠正的功能。
- 并且它是将应用程序发来的数据在收到的那一刻，立即按照原样发送到网络上的一种机制。即使是出现网络拥堵的情况，UDP 也无法进行流量控制等避免网络拥塞行为。
- 如果需要以上的细节控制，不得不交由采用 UDP 的应用程序去处理。

基于 UDP 的应用层协议：DNS（域名转换）、TFTP（文件传输）、NFS（远程文件服务器）

**UDP**

```js
//UDP收包率低/丢包率高的原因分析
1 缓存太小，不能及时接收数据。
连续多个UDP包超过了UDP接收缓冲区大小 ，比如：
如：UDP包过大 || UDP发包速率过快，突发大数据流量超过了缓冲区上限
2 recvfrom()接收到数据之后处理速度太慢
如果数据接收和处理是连续进行的，那么可能由于数据处理过慢，两次recvfrom调用的时间间隔里发过来的包丢失。

//对应的解决方法
1 UDP包过大
解决方法：增加系统发送或接收缓冲区大小
2 发包速率过快
解决方法:增加应答机制，处理完一个包后，在继续发包
3 recvfrom()接收到数据之后处理速度太慢
服务器程序启动之出，开辟两个线程，一个线程专门用于接收数据包，并存放在应用层的缓存区；另外一个线程用于专门处理和响应数据包请求，避免因为处理数据造成数据丢包。其本质上还是增大了缓冲区大小，只是将系统缓冲区转移到了应用层自己的缓冲区。
4 最复杂的方式
在应用层实现丢包重发机制和超时机制，确保数据包不丢失。

//如果UDP编程的时候的数据大于64kb 会怎么样？
1、在应用层进行数据包的拆分和组合。
2、 大于64KB 时不处理，会交给TCP/IP协议去处理，在网络层进行分包和组包，但是这种方式不用，容易丢包，一旦丢包便整体舍弃，及其不稳定。

//基于UDP实现的协议
DNS（域名解析服务）
```

## 
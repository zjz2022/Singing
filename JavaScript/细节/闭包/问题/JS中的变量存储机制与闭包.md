## JS中的变量存储机制与闭包

弄清楚了**堆** 和 **栈** 存储数据的方式和特点，那么对于JS中的变量存储机制的结论： **对于原始类型，数据本身是存在栈内，对于对象类型，在栈中存的只是一个堆内地址的引用** 应该是符合逻辑的，但是，我们都知道js中存在**闭包**的概念，所谓的闭合包指：

一个函数和对其周围状态（lexical environment，词法环境）的引用捆绑在一起（或者说函数被引用包围），这样的组合就是**闭包（closure）**。也就是说，闭包让你可以在一个内层函数中访问到其外层函数的作用域。在 JavaScript 中，每当创建一个函数，闭包就会在函数创建的同时被创建出来。([引用自MDN](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Closures))

既然栈中数据在函数执行结束后就会被销毁，那么 JavaScript 中函数闭包该如何实现的呢？来看下如下代码

```js
function sum () {
    let i = 0;
    return function () {
        i++;
        return i;
    }
}

let sumFun = sum();
sumFun(); // 1
sumFun(); // 2
```

如果按照 上面的结论 `i` 在 `sum` 函数调用时创建，在函数调用结束 retun时就从栈中弹出，变量 i 会被销毁。那么为啥 调用 `sumFun` 函数时会输出结果 `1` 呢？

因此 在上面的例子中也就是存在**闭包**的情况，变量并没有保存在栈中，而应该保存在堆中，供 sumFun 函数使用。 要弄明白这个问题，首先我们要好好了解下`JavaScript` 中不同的变量类型，不同类型的变量存储机制是不同的。
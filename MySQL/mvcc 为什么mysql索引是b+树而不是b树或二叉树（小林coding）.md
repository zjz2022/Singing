## mvcc? 为什么mysql索引是b+树而不是b树或二叉树（小林coding）

**解析**

> 属于高频考题：[大厂后端Top100面试题讲解](https://mp.weixin.qq.com/s?__biz=Mzk0OTM5MDMzNg==&mid=2247483813&idx=1&sn=d76cd77235886194667bb81cd1920b64&scene=21#wechat_redirect)
>
> 所属专项：MySQL｜事务
>
> 专项考察占比：
>
> 【**MySQL**】面试中考察MySQL的比率：[大厂：18%](https://mp.weixin.qq.com/s?__biz=Mzk0OTM5MDMzNg==&mid=2247483843&idx=1&sn=7c7bd2c6b906c0ab38c868b84b88da56&chksm=c3585cacf42fd5ba38542da8ac77a7e731b486243c4aaf249d46d91b6c5e0e4e945f9729ad98&token=1036259463&lang=zh_CN&scene=21#wechat_redirect)｜ [腾讯：13%](https://mp.weixin.qq.com/s?__biz=Mzk0OTM5MDMzNg==&mid=2247483854&idx=1&sn=668db515e36dcdc8c180b11abef66e72&chksm=c3585ca1f42fd5b7d399b32a3c909b61a16f13c3bdb6ef6e0461470acdd3955c33a8a0d46120&token=1036259463&lang=zh_CN&scene=21#wechat_redirect)｜ [阿里：17%](https://mp.weixin.qq.com/s?__biz=Mzk0OTM5MDMzNg==&mid=2247483854&idx=1&sn=668db515e36dcdc8c180b11abef66e72&chksm=c3585ca1f42fd5b7d399b32a3c909b61a16f13c3bdb6ef6e0461470acdd3955c33a8a0d46120&token=1036259463&lang=zh_CN&scene=21#wechat_redirect)
>
> 【**MySQL-事务**】面试考察MySQL时，问“事务”相关问题的比率：[18%](https://mp.weixin.qq.com/s?__biz=Mzk0OTM5MDMzNg==&mid=2247483843&idx=1&sn=7c7bd2c6b906c0ab38c868b84b88da56&chksm=c3585cacf42fd5ba38542da8ac77a7e731b486243c4aaf249d46d91b6c5e0e4e945f9729ad98&token=1036259463&lang=zh_CN&scene=21#wechat_redirect)

**参考口述回答**

### 详细介绍下MVCC？

**一、MVCC的基本概念**

MVCC允许多个事务同时读取同一行数据，而不会彼此阻塞，每个事务看到的数据版本是该事务开始时的数据版本。这意味着，如果其他事务在此期间修改了数据，正在运行的事务仍然看到的是它开始时的数据状态，从而实现了非阻塞读操作。

**二、不同隔离级别下的MVCC实现**

1. **读未提交（Read Uncommitted）** ：在这个隔离级别下，事务可以读取到其他未提交事务的修改。然而，这通常不被推荐，因为它可能导致脏读。在MVCC的上下文中，这个级别并不会创建数据的多个版本。
2. **读已提交（Read Committed）** ：在这个级别，每次查询都会生成一个新的数据快照。当事务进行读取操作时，它只能看到在该事务开始之前已经被提交的数据。这意味着，如果数据在事务执行过程中被其他事务修改并提交，那么当前事务在下次查询时将看到这些更改。MVCC通过为每个事务提供其开始时的数据版本来实现这一点。
3. **可重复读（Repeatable Read）** ：这是MySQL的默认隔离级别。在这个级别下，事务在开始时创建一个数据快照，并且在整个事务过程中都使用这个快照。即使其他事务在此期间修改了数据并提交，当前事务仍然看到的是它开始时的数据状态。MVCC通过保存数据的多个版本来实现这一点，每个版本都与一个特定的事务相关联。
4. **串行化（Serializable）** ：这是最严格的隔离级别。在这个级别下，事务是完全串行执行的，避免了所有并发问题。然而，这也意味着性能可能受到影响，因为事务必须等待其他事务完成才能继续执行。在MVCC的上下文中，这个级别可能会退化为单版本控制，因为所有事务都是串行执行的。

**三、MVCC的工作原理**

MVCC的工作原理是基于数据版本的管理。每当数据被修改时，数据库不是直接更新原始数据，而是创建一个新的数据版本。每个版本都与一个事务ID相关联，这个ID表示哪个事务创建了该版本。当事务进行读取操作时，数据库会根据该事务的隔离级别和当前活跃的事务列表来决定哪个版本的数据应该被返回。

此外，MVCC还依赖于一种称为“Read View”的机制来确定哪些版本的数据对当前事务是“可见”的。Read View本质上是一个事务ID的列表，它表示在当前事务开始时尚未提交的其他事务。通过这个列表，数据库可以判断哪些数据版本对当前事务是不可见的（因为它们是由尚未提交的事务创建的）。

### 为什么mysql索引是b+树而不是b树或二叉树

一、树的高度

B+树相较于B树，其树的高度更低。这是因为B+树的非叶子节点不存储数据，只存储索引，因此可以容纳更多的子节点，使得整个树的结构更加扁平化。这种设计减少了查询时需要经过的层级数，最重要是减少了磁盘IO的次数，从而提高了查询效率。相比之下，B树的每个节点都存储数据，导致节点容纳的子节点数量有限，树的高度相对较高。

二、插入删除效率

在插入和删除操作方面，B+树也表现出更高的效率。由于B+树的非叶子节点不存储数据，因此在插入或删除数据时，只需要调整索引结构，而不需要频繁地移动大量数据。这大大简化了插入和删除操作的过程，并提高了效率。相比之下，B树在插入或删除数据时可能需要更复杂的操作来保持树的平衡。

三、范围查询效率

B+树在范围查询方面具有显著优势。由于B+树的叶子节点包含所有数据，并且叶子节点之间通过指针相连，形成了一个有序链表结构。这种结构使得范围查询变得非常简单和高效，因为我们可以直接通过叶子节点的指针顺序访问范围内的数据。而在B树中，范围查询可能需要更复杂的中序遍历操作。

**推荐学习资料**

《掘金专栏》｜全解MySQL数据库：# (九)MySQL之MVCC机制：为什么你改了的数据我还看不见

《掘金专栏》｜全解MySQL数据库：# MySQL索引为何使用B+树结构？
## App Router介绍

### 基本概念：

### App Directory

App Router 引入了一个新的 app 目录，该目录用于组织应用的页面、布局和数据依赖。它提供了一种更灵活的方式来组织代码。

### 文件系统路由

类似于之前的 pages 目录，app 目录中的文件结构决定了路由的结构。文件和文件夹的名称直接映射为路由路径。



## 布局（Layouts）：

### 层级布局

在 app 目录中，你可以创建布局组件来定义页面的共通结构，如头部和底部。布局可以嵌套，提供了一种层级式的方式来共享组件和逻辑。

### 布局持久化

布局组件可以持久化在页面跳转中，这意味着当你在页面间导航时，共通的布局部分不会重新渲染。



## 增强的数据获取：

### 服务器端数据获取

你可以在 app 目录中使用 getServerData 函数来获取服务器端数据。这类似于之前的 getServerSideProps，但提供了更多的灵活性。

### 客户端数据获取

App Router 还支持在客户端获取数据，使得数据获取逻辑与页面和布局紧密结合。



## 性能优化：

### 并行数据和代码加载

App Router 允许同时加载页面的数据和代码，减少了页面加载时间。

### 流式传输

支持流式传输响应，这意味着浏览器可以在全部数据到达之前开始渲染页面。



## 更好的开发体验：

### 清晰的项目结构

通过使用 app 目录和布局，项目的结构变得更加清晰和模块化。

### 更少的全页面刷新

由于布局持久化和优化的数据获取机制，全页面刷新的情况大大减少，提升了用户体验



## 如何使用

### 文件系统路由：

在app目录下，创建目录即为一个路由，page文件即为当前路由展示内容
例如，app/question/page.tsx 对应 /question 路径。



### 布局路由：

layout文件为当前路由使用的layout，layout中接收一个children参数为子路由组件
最顶层的布局称为根布局（Root Layout）。这个必需的布局在应用的所有页面中共享。根布局必须包含 html 和 body 标签，并且也只有根布局可以包含。
布局无法访问其下方的路由段。要访问所有路由段，你可以在客户端组件中使用 useSelectedLayoutSegment 或 useSelectedLayoutSegments
在next.js中与layout相似的一个东西是template
它们都会包裹每个子布局或页面。但与跨路由保持状态的布局不同，模板在导航时为每个子组件创建一个新实例。这意味着，当用户在共享同一模板的路由间导航时，组件的新实例会被挂载，DOM 元素会被重新创建，状态不会被保留，且效果（effects）会重新同步。



### 动态路由：

动态路由也通过方括号来定义。

![image.png](D:/%E6%96%87%E4%BB%B6/typora%E5%9B%BE%E7%89%87/1701499719734-8d85748f-9642-4a9f-8195-a8b7649f03bd.webp)

![image.png](D:/%E6%96%87%E4%BB%B6/typora%E5%9B%BE%E7%89%87/1701499769116-5f2e9e1b-11e2-4e3b-8af6-8a96abecd7d1.webp)

![image.png](D:/%E6%96%87%E4%BB%B6/typora%E5%9B%BE%E7%89%87/1701499823176-92214aa5-6630-4841-8a9b-7c8a48c4be23.webp)

如何获取路由参数：

可以使用usePathname()这个hook来截取路由参数

也可以在props中解构路由参数



### 路由组：

可以通过将目录命名为（name）的形式来定义路由组
注意：路由组的命名除了组织目的外没有特别的意义。它们不影响 URL 路径。
包含路由组的路由不应解析为与其他路由相同的 URL 路径。例如，由于路由组不影响 URL 结构，(marketing)/about/page.js 和 (shop)/about/page.js 都会解析为 /about 并导致错误。
如果你在没有顶级 layout.js 文件的情况下使用多个根布局，你的首页 page.js 文件应该定义在其中一个路由组中，例如：app/(marketing)/page.js。
跨越多个根布局的导航将导致完整页面加载（与客户端导航相反）。例如，从使用 app/(shop)/layout.js 的 /cart 导航到使用 app/(marketing)/layout.js 的 /blog 将导致完整页面加载。这仅适用于多个根布局。



### 平行路由：

可以通过将目录命名为@name的方式来定义平行路由

![image-20240409201702721](D:/%E6%96%87%E4%BB%B6/typora%E5%9B%BE%E7%89%87/image-20240409201702721.png)

### 路由钩子和函数：

useRouter 钩子：可以在组件中使用 useRouter 来访问当前的路由对象。
Link 组件：使用 <Link> 组件来创建客户端的路由跳转链接。
重定向和服务器端路由：在 getServerSideProps 或 API 路由中，你可以处理重定向或复杂的服务器端路由逻辑。